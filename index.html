<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>糖質・インスリン計算ツール</title>

<style>
  body {
    font-family: sans-serif;
    padding: 10px;
    max-width: 600px;
    margin: auto;
    font-size: 18px;
  }

  h1 {
    text-align: center;
    font-size: 26px;
  }

  /* タブ */
  .tabs button {
    width: 33.33%;
    padding: 12px;
    font-size: 18px;
    border: none;
    background: #ddd;
  }

  .tabs button.active {
    background: #007bff;
    color: white;
  }

  .tab-content {
    display: none;
    margin-top: 20px;
  }

  label {
    display: block;
    margin-top: 15px;
    font-size: 18px;
  }

  input, select {
    width: 100%;
    padding: 10px;
    font-size: 20px;
    box-sizing: border-box;
  }

  button.main-btn {
    width: 100%;
    padding: 14px;
    background: #007bff;
    color: white;
    border: none;
    margin-top: 20px;
    font-size: 20px;
    border-radius: 8px;
  }

  #result {
    padding: 15px;
    margin-top: 20px;
    background: #eef7ff;
    border-radius: 8px;
    font-size: 20px;
  }

</style>
</head>

<body>

<h1>糖質・インスリン計算ツール</h1>

<!-- タブ -->
<div class="tabs">
  <button onclick="openTab(1)" class="active">① インスリン計算</button>
  <button onclick="openTab(2)">② 食べ物→糖質</button>
  <button onclick="openTab(3)">③ グラフ</button>
</div>

<!-- ①インスリン計算タブ -->
<div id="tab1" class="tab-content" style="display:block;">

  <h2>① 注射するインスリン量を計算</h2>

  <!-- 朝昼夜ボタン -->
  <label>◆ 食事の時間帯：</label>
  <select id="mealTime">
    <option value="morning">朝</option>
    <option value="noon">昼</option>
    <option value="night">夜</option>
  </select>

  <!-- 朝昼夜ごとの補正係数 -->
  <label>◆ 補正係数（1Uで下がる血糖値）※時間帯ごと：</label>
  <input id="cf_morning" type="number" placeholder="朝の補正係数">
  <input id="cf_noon" type="number" placeholder="昼の補正係数">
  <input id="cf_night" type="number" placeholder="夜の補正係数">

  <!-- 主食入力 -->
  <label>◆ 主食：</label>
  <select id="mainFood">
    <option value="rice">ごはん</option>
    <option value="bread">パン</option>
    <option value="noodle">麺類</option>
  </select>

  <label>主食の量（g）：</label>
  <input id="mainGram" type="number">

  <!-- パン用の直接入力糖質 -->
  <label>パンの場合：直接糖質を入力（任意）：</label>
  <input id="breadCarb" type="number" placeholder="パンの糖質（任意）">

  <!-- その他食品 -->
  <label>◆ その他の食品の糖質：</label>
  <input id="otherCarbs" type="number" placeholder="他の食品の糖質（g）">

  <!-- ユーザー設定 -->
  <label>◆ カーボ比（g/U）：</label>
  <input id="carbRatio" type="number">

  <label>◆ 現在血糖値：</label>
  <input id="currentBg" type="number">

  <label>◆ 目標血糖値：</label>
  <input id="targetBg" type="number">

  <button class="main-btn" onclick="calculateInsulin()">インスリン量を計算</button>

  <div id="result"></div>

</div>

<!-- ②タブ（空 placeholder） -->
<div id="tab2" class="tab-content">
  <h2>② 食べ物→糖質の計算（次のステップで実装）</h2>
</div>

<!-- ③タブ（空 placeholder） -->
<div id="tab3" class="tab-content">
  <h2>③ グラフ（次のステップで実装）</h2>
</div>

<script>
// タブ操作
function openTab(num) {
  document.querySelectorAll(".tab-content").forEach(t => t.style.display = "none");
  document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));

  document.getElementById("tab" + num).style.display = "block";
  document.querySelectorAll(".tabs button")[num - 1].classList.add("active");
}

// 主食の糖質表
const carbTable = {
  rice: 0.37,
  bread: 0.44,
  noodle: 0.25
};

// 初期化：保存値をロード
window.onload = function() {
  ["carbRatio","targetBg","cf_morning","cf_noon","cf_night"].forEach(id => {
    if(localStorage.getItem(id)) document.getElementById(id).value = localStorage.getItem(id);
  });
};

// 計算
function calculateInsulin() {

  // 保存
  ["carbRatio","targetBg","cf_morning","cf_noon","cf_night"].forEach(id => {
    localStorage.setItem(id, document.getElementById(id).value);
  });

  const meal = document.getElementById("mealTime").value;
  const carbRatio = Number(document.getElementById("carbRatio").value);
  const currentBg = Number(document.getElementById("currentBg").value);
  const targetBg = Number(document.getElementById("targetBg").value);

  // 時間帯の補正係数
  const cf = {
    morning: Number(document.getElementById("cf_morning").value),
    noon: Number(document.getElementById("cf_noon").value),
    night: Number(document.getElementById("cf_night").value)
  }[meal];

  // 主食
  const mainType = document.getElementById("mainFood").value;
  let mainCarb = 0;

  if (mainType === "bread" && document.getElementById("breadCarb").value) {
    mainCarb = Number(document.getElementById("breadCarb").value);
  } else {
    const gram = Number(document.getElementById("mainGram").value);
    mainCarb = gram * carbTable[mainType];
  }

  const otherCarb = Number(document.getElementById("otherCarbs").value) || 0;
  const totalCarb = mainCarb + otherCarb;

  // インスリン
  const carbInsulin = totalCarb / carbRatio;
  const correctionInsulin = (currentBg - targetBg) / cf;
  const totalInsulin = Math.max(carbInsulin + correctionInsulin, 0);

  document.getElementById("result").innerHTML =
    `主食の糖質：${mainCarb.toFixed(1)} g<br>
     他の糖質：${otherCarb.toFixed(1)} g<br>
     合計糖質：<b>${totalCarb.toFixed(1)} g</b><br><br>
     必要インスリン量：<b>${totalInsulin.toFixed(2)} U</b>`;
}
</script>

</body>
</html>
